<!DOCTYPE html>
<html lang="id">
  
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Dashboard Fullfilment FBB untuk monitoring House Keeping dan performa operasional.">
    <meta name="keywords" content="Fullfilment, FBB, Dashboard, House Keeping, Monitoring, Performance, Telkom">
    <meta name="author" content="Tim Fullfilment FBB">
    <title>Fullfilment FBB - Dashboard House Keeping & Performance</title>
    <link rel="canonical" href="/dashboard.html"/>
    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="Fullfilment FBB - Dashboard House Keeping & Performance"/>
    <meta property="og:description" content="Dashboard interaktif untuk monitoring House Keeping dan performa FBB."/>
    <meta property="og:image" content="/images/icon/logo.png"/>
    <meta property="og:type" content="website"/>
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="Fullfilment FBB - Dashboard House Keeping & Performance"/>
    <meta name="twitter:description" content="Dashboard interaktif untuk monitoring House Keeping dan performa FBB."/>
    <meta name="twitter:image" content="/images/icon/logo.png"/>
    <!-- CSS Files -->
    <link href="/css/font-face.css" rel="stylesheet">
    <link href="/vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet">
    <link href="/vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet">
    <link href="/vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet">
    <link href="/vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet">
    <link href="/vendor/animsition/animsition.min.css" rel="stylesheet">
    <link href="/vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet">
    <link href="/vendor/wow/animate.css" rel="stylesheet">
    <link href="/vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet">
    <link href="/vendor/slick/slick.css" rel="stylesheet">
    <link href="/vendor/select2/select2.min.css" rel="stylesheet">
    <link href="/vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
      .main-content {
        max-width: 1600px;
        margin: 0 auto;
        background: #f7fafc;
        border-radius: 18px;
        padding: 16px 4vw 32px 4vw;
        min-height: 100vh;
      }
      .dashboard-row {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-bottom: 24px;
      }
      @media (min-width: 1024px) {
        .dashboard-row {
          flex-direction: row;
          gap: 32px;
          margin-bottom: 32px;
        }
      }
      .dashboard-row > div {
        flex: 1 1 0;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 2px 12px 0 #0001;
        padding: 16px 8px 16px 8px;
        min-width: 0;
        min-height: 220px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
        max-width: 100%;
      }
      @media (min-width: 640px) {
        .dashboard-row > div {
          padding: 24px 16px 24px 16px;
          min-height: 320px;
        }
      }
      @media (max-width: 640px) {
        .main-content {
          padding: 8px 2vw 16px 2vw;
        }
        .dashboard-row > div {
          min-height: 180px;
          padding: 10px 2px;
        }
        table th, table td {
          padding: 6px 6px;
          font-size: 12px;
        }
      }
      table {
        border-collapse: collapse;
        width: 100%;
        background: #fff;
        margin-top: 8px;
        font-size: 14px;
      }
      th, td {
        border: 1px solid #e5e7eb;
        padding: 8px 12px;
        text-align: left;
      }
      th {
        background: #f3f4f6;
        font-weight: bold;
      }
      tr:nth-child(even) td {
        background: #f9fafb;
      }
      /* Responsive chart container */
      .chart-responsive {
        width: 100%;
        min-width: 0;
        max-width: 100%;
        aspect-ratio: 4/5;
        min-height: 220px;
        max-height: 400px;
        position: relative;
        margin: 0 auto;
      }
      @media (max-width: 640px) {
        .chart-responsive {
          aspect-ratio: 1/1;
          min-height: 160px;
          max-height: 260px;
        }
      }
    </style>
</head>

<body class="animsition">
    <div class="page-wrapper">
        <!-- Header Mobile Responsive -->
        <header class="block lg:hidden">
          <div class="flex items-center justify-between px-4 py-2 bg-white shadow">
            <a class="logo" href="/">
              <img src="/images/icon/logo.png" alt="FBB" class="h-8">
            </a>
            <button id="mobileMenuBtn" class="text-2xl focus:outline-none">
              <i class="fas fa-bars"></i>
            </button>
          </div>
          <!-- Overlay & Menu -->
          <div id="mobileMenuOverlay" class="fixed inset-0 bg-black bg-opacity-40 z-40 hidden"></div>
          <nav id="mobileMenu" class="fixed top-0 left-0 w-64 h-full bg-white z-50 transform -translate-x-full transition-transform duration-300">
            <div class="p-4 border-b flex items-center justify-between">
              <span class="font-bold text-lg">Menu</span>
              <button id="closeMobileMenu" class="text-xl"><i class="fas fa-times"></i></button>
            </div>
            <ul class="mt-4 space-y-2">
              <li>
                <a href="#" class="flex items-center px-4 py-2 hover:bg-gray-100"><i class="fas fa-house-user mr-2"></i> House Keeping</a>
                <ul class="ml-6 mt-1 space-y-1">
                  <li><a href="/dashboard.html" class="flex items-center px-2 py-1 hover:bg-gray-100"><i class="fas fa-tachometer-alt mr-2"></i> Dashboard</a></li>
                  <li><a href="/hk/" class="flex items-center px-2 py-1 hover:bg-gray-100"><i class="fas fa-tools mr-2"></i> Tool House Keeping</a></li>
                </ul>
              </li>
            </ul>
          </nav>
        </header>
        <!-- END Header Mobile Responsive -->
        
        <!-- Sidebar -->
        <aside class="menu-sidebar d-none d-lg-block">
            <div class="logo">
                <a href="#">
                    <img src="/images/icon/logo.png" alt="FBB">
                </a>
            </div>
            <div class="menu-sidebar__content js-scrollbar1">
              <nav class="navbar-sidebar">
                  <ul class="list-unstyled navbar__list">
                      <li class="has-sub">
                          <a class="js-arrow" href="#"><i class="fas fa-house-user"></i>House Keeping</a>
                          <ul class="list-unstyled navbar__sub-list js-sub-list">
                              <li class="active has-sub">
                                <a class="js-arrow" href="/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                              </li>
                              <li>
                                <a class="js-arrow" href="/hk/"><i class="fas fa-tools"></i> Tool House Keeping</a>
                              </li>
                          </ul>
                      </li>
                  </ul>
              </nav>
          </div>
        </aside>

        <!-- Page Container -->
        <div class="page-container">
            <!-- Headbar Menu (moved here) -->
            <div class="w-full bg-white shadow px-4 sm:px-8 py-3 z-10" style="position:sticky;top:0;">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                  <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 tracking-tight text-center sm:text-left">Fullfilment FBB Dashboard</h1>
                  <span class="text-xs sm:text-sm text-gray-400 flex items-center justify-center gap-1"><i class="fa fa-thumbtack text-pink-500"></i> Last Updated: <span id="lastUpdated">-</span></span>
                </div>
            </div>
            <main class="main-content">
                <div class="flex flex-wrap gap-2 sm:gap-4 mb-4 sm:mb-6 items-end">
                    <div id="activeFilters" class="flex flex-wrap gap-2 mb-2"></div>
                    <select id="branchFilter" class="border rounded px-2 py-1 text-xs sm:text-sm"></select>
                    <input type="text" id="startDate" class="border rounded px-2 py-1 text-xs sm:text-sm date-mdy" placeholder="MM/DD/YYYY">
                    <input type="text" id="endDate" class="border rounded px-2 py-1 text-xs sm:text-sm date-mdy" placeholder="MM/DD/YYYY">
                    <button onclick="applyFilters()" class="bg-blue-500 text-white px-4 py-1 rounded text-xs sm:text-sm">Filter</button>
                    <button id="resetFilters" class="bg-gray-300 text-gray-700 px-4 py-1 rounded text-xs sm:text-sm ml-2">Reset</button>
                </div>
                <div class="dashboard-row">
                    <div>                 
                        <div class="chart-responsive">
                          <canvas id="pieHK" class="w-full h-full absolute top-0 left-0"></canvas>
                        </div>
                    </div>
                    <div>
                        <div class="chart-responsive" style="aspect-ratio: 4/3;">
                          <canvas id="progressSymptom" class="w-full h-full absolute top-0 left-0"></canvas>
                        </div>
                    </div>
                </div>
                <div class="dashboard-row">
                    <div class="w-full max-w-4xl mx-auto">
                        <div class="chart-responsive" style="aspect-ratio: 6/2;">
                          <canvas id="barTrend" class="w-full h-full absolute top-0 left-0"></canvas>
                        </div>
                    </div>
                </div>
                <div class="dashboard-row">
                    <div class="overflow-x-auto w-full">
                        <h3 class="font-bold mb-2 text-base sm:text-lg">Symptom to PS</h3>
                        <div class="overflow-x-auto w-full">
                          <table id="tableSymptom" class="min-w-full text-xs sm:text-sm"></table>
                        </div>
                    </div>
                    <div class="overflow-x-auto w-full">
                        <h3 class="font-bold mb-2 text-base sm:text-lg">Fallout NOP to PS</h3>
                        <div class="overflow-x-auto w-full">
                          <table id="tableNop" class="min-w-full text-xs sm:text-sm"></table>
                        </div>
                    </div>
                    <div class="overflow-x-auto w-full">
                        <h3 class="font-bold mb-2 text-base sm:text-lg">Result House Keeping</h3>
                        <div class="overflow-x-auto w-full">
                          <table id="tableHK" class="min-w-full text-xs sm:text-sm"></table>
                        </div>
                    </div>
                </div>
                <!-- New Aging Symptom Table -->
                <div class="dashboard-row">
                    <div class="overflow-x-auto w-full">
                        <h3 class="font-bold mb-2 text-base sm:text-lg">Aging Symptom</h3>
                        <div class="overflow-x-auto w-full">
                          <table id="tableAgingSymptom" class="min-w-full text-xs sm:text-sm"></table>
                        </div>
                    </div>
                </div>
            </main>
            <!-- Improved Footer -->
            <footer class="w-full bg-gray-100 py-4 sm:py-6 mt-8 shadow-inner">
                <div class="container mx-auto flex flex-col md:flex-row justify-between items-center px-2 sm:px-6">
                    <div class="flex items-center gap-2 mb-2 md:mb-0">
                        <img src="/images/icon/logo.png" alt="FBB" class="h-8 w-auto">
                        <span class="text-gray-700 font-semibold text-sm sm:text-base">FBB Telkomsel</span>
                    </div>
                    <div class="text-gray-500 text-xs sm:text-sm">&copy; 2025 FBB Telkomsel. All rights reserved.</div>
                    <div class="flex gap-3 mt-2 md:mt-0">
                        <a href="#" class="text-gray-400 hover:text-blue-600"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-gray-400 hover:text-blue-600"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-blue-600"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </footer>
        </div>
        <!-- JS Files -->
        <script src="/vendor/jquery-3.2.1.min.js"></script>
        <script src="/vendor/bootstrap-4.1/popper.min.js"></script>
        <script src="/vendor/bootstrap-4.1/bootstrap.min.js"></script>
        <script src="/vendor/slick/slick.min.js"></script>
        <script src="/vendor/wow/wow.min.js"></script>
        <script src="/vendor/animsition/animsition.min.js"></script>
        <script src="/vendor/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
        <script src="/vendor/counter-up/jquery.waypoints.min.js"></script>
        <script src="/vendor/counter-up/jquery.counterup.min.js"></script> 
        <script src="/vendor/circle-progress/circle-progress.min.js"></script> 
        <script src="/vendor/perfect-scrollbar/perfect-scrollbar.js"></script> 
        <script src="/vendor/chartjs/Chart.bundle.min.js"></script> 
        <script src="/vendor/select2/select2.min.js"></script> 
        <script src="/js/main.js"></script>
        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
        <!-- Refactored dashboard script -->
        <script src="/js/dashboard.js"></script>
        <!-- Mobile Menu Script -->
        <script>
          const mobileMenuBtn = document.getElementById('mobileMenuBtn');
          const mobileMenu = document.getElementById('mobileMenu');
          const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
          const closeMobileMenu = document.getElementById('closeMobileMenu');
          function openMenu() {
            mobileMenu.classList.remove('-translate-x-full');
            mobileMenuOverlay.classList.remove('hidden');
          }
          function closeMenu() {
            mobileMenu.classList.add('-translate-x-full');
            mobileMenuOverlay.classList.add('hidden');
          }
          if(mobileMenuBtn) mobileMenuBtn.addEventListener('click', openMenu);
          if(closeMobileMenu) closeMobileMenu.addEventListener('click', closeMenu);
          if(mobileMenuOverlay) mobileMenuOverlay.addEventListener('click', closeMenu);
        </script>
        <script>
        async function fetchLastUpdated() {
          try {
            const response = await fetch('/api/realtime?last_updated=1');
            if (response.ok) {
              const data = await response.json();
              if (data.last_updated) {
                const date = new Date(data.last_updated);
                document.getElementById('lastUpdated').innerHTML = formatLastUpdated(date);
              } else {
                document.getElementById('lastUpdated').textContent = '-';
              }
            }
          } catch (e) {
            document.getElementById('lastUpdated').textContent = '-';
          }
        }
        function pad2(n) { return n.toString().padStart(2, '0'); }
        function formatLastUpdated(date) {
          const hari = ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
          const utc = date.getTime();
          const wib = new Date(utc + 7 * 60 * 60 * 1000);
          const wita = new Date(utc + 8 * 60 * 60 * 1000);
          const wit = new Date(utc + 9 * 60 * 60 * 1000);
          return `${hari[wib.getUTCDay()]} ${pad2(wib.getUTCDate())}/${pad2(wib.getUTCMonth()+1)}/${wib.getUTCFullYear()} ` +
                 `<span style=\"background:#3b82f6;color:#fff;padding:2px 8px;border-radius:4px;\">${pad2(wib.getUTCHours())}:${pad2(wib.getUTCMinutes())} WIB</span> / ` +
                 `<span style=\"background:#2563eb;color:#fff;padding:2px 8px;border-radius:4px;\">${pad2(wita.getUTCHours())}:${pad2(wita.getUTCMinutes())} WITA</span> / ` +
                 `<span style=\"background:#1e293b;color:#fff;padding:2px 8px;border-radius:4px;\">${pad2(wit.getUTCHours())}:${pad2(wit.getUTCMinutes())} WIT</span>`;
        }
        document.addEventListener('DOMContentLoaded', fetchLastUpdated);
        </script>
        <!-- Firebase SDK -->
        <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
        <script src="/js/firebase-config.js"></script>
        <script src="/js/auth-guard.js"></script>
        <script>
          // Enforce login and show user info
          window.requireLogin && window.requireLogin();
        </script>
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    </div>
</body>
</html> 