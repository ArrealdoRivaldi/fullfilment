<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<button id="logoutBtn" style="position:fixed;top:16px;right:16px;z-index:1000;padding:8px 18px;background:#e53e3e;color:#fff;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">Logout</button>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCjBlPnJSlEq18tJett5ZdOAcMl2yPvlOE",
    authDomain: "fbb-fullfilment.firebaseapp.com",
    databaseURL: "https://fbb-fullfilment-default-rtdb.firebaseio.com",
    projectId: "fbb-fullfilment",
    storageBucket: "fbb-fullfilment.firebasestorage.app",
    messagingSenderId: "842233083514",
    appId: "1:842233083514:web:beb0ce0ac38fc5825eedc3",
    measurementId: "G-9RPL0LSY4Q"
  };
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const firestore = firebase.firestore();

  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      window.location.href = '/login.html';
    } else {
      const userDoc = await firestore.collection('login').doc('users').get();
      if (!userDoc.exists || userDoc.data().email !== user.email) {
        await auth.signOut();
        alert('Akses ditolak: Email tidak terdaftar.');
        window.location.href = '/login.html';
      } else {
        const data = userDoc.data();
        if (data.role !== 'admin') {
          alert('Akses khusus admin!');
          window.location.href = '/dashboard.html';
        }
      }
    }
  });

  document.getElementById('logoutBtn').onclick = function() {
    firebase.auth().signOut().then(function() {
      window.location.href = '/login.html';
    });
  };
</script> 