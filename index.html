<!DOCTYPE html>
<html lang="en">
  
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">
    <title>Menu Dashboard FBB</title>
 
    <!-- CSS Files -->
    <link href="css/font-face.css" rel="stylesheet">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet">
    <link href="vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet">
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet">
    <link href="vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet">
    <link href="vendor/animsition/animsition.min.css" rel="stylesheet">
    <link href="vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet">
    <link href="vendor/wow/animate.css" rel="stylesheet">
    <link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet">
    <link href="vendor/slick/slick.css" rel="stylesheet">
    <link href="vendor/select2/select2.min.css" rel="stylesheet">
    <link href="vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet">
    <link href="css/theme.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      .main-content {
        max-width: 1600px;
        margin: 0 auto;
        background: #f7fafc;
        border-radius: 18px;
        padding: 16px 4vw 32px 4vw;
        min-height: 100vh;
      }
      .dashboard-row {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-bottom: 24px;
      }
      @media (min-width: 1024px) {
        .dashboard-row {
          flex-direction: row;
          gap: 32px;
          margin-bottom: 32px;
        }
      }
      .dashboard-row > div {
        flex: 1 1 0;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 2px 12px 0 #0001;
        padding: 16px 8px 16px 8px;
        min-width: 0;
        min-height: 320px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
      }
      @media (min-width: 640px) {
        .dashboard-row > div {
          padding: 24px 16px 24px 16px;
          min-height: 420px;
        }
      }
      table {
        border-collapse: collapse;
        width: 100%;
        background: #fff;
        margin-top: 8px;
      }
      th, td {
        border: 1px solid #e5e7eb;
        padding: 8px 12px;
        text-align: left;
      }
      th {
        background: #f3f4f6;
        font-weight: bold;
      }
      tr:nth-child(even) td {
        background: #f9fafb;
      }
    </style>
</head>

<body class="animsition">
    <div class="page-wrapper">
        <!-- Header Mobile Responsive -->
        <header class="block lg:hidden">
          <div class="flex items-center justify-between px-4 py-2 bg-white shadow">
            <a class="logo" href="index.html">
              <img src="images/icon/logo.png" alt="FBB" class="h-8">
            </a>
            <button id="mobileMenuBtn" class="text-2xl focus:outline-none">
              <i class="fas fa-bars"></i>
            </button>
          </div>
          <!-- Overlay & Menu -->
          <div id="mobileMenuOverlay" class="fixed inset-0 bg-black bg-opacity-40 z-40 hidden"></div>
          <nav id="mobileMenu" class="fixed top-0 left-0 w-64 h-full bg-white z-50 transform -translate-x-full transition-transform duration-300">
            <div class="p-4 border-b flex items-center justify-between">
              <span class="font-bold text-lg">Menu</span>
              <button id="closeMobileMenu" class="text-xl"><i class="fas fa-times"></i></button>
            </div>
            <ul class="mt-4 space-y-2">
              <li>
                <a href="#" class="flex items-center px-4 py-2 hover:bg-gray-100"><i class="fas fa-house-user mr-2"></i> House Keeping</a>
                <ul class="ml-6 mt-1 space-y-1">
                  <li><a href="index.html" class="flex items-center px-2 py-1 hover:bg-gray-100"><i class="fas fa-tachometer-alt mr-2"></i> Dashboard</a></li>
                  <li><a href="hk.html" class="flex items-center px-2 py-1 hover:bg-gray-100"><i class="fas fa-tools mr-2"></i> Tool House Keeping</a></li>
                </ul>
              </li>
            </ul>
          </nav>
        </header>
        <!-- END Header Mobile Responsive -->
        
        <!-- Sidebar -->
        <aside class="menu-sidebar d-none d-lg-block">
            <div class="logo">
                <a href="#">
                    <img src="images/icon/logo.png" alt="FBB">
                </a>
            </div>
            <div class="menu-sidebar__content js-scrollbar1">
              <nav class="navbar-sidebar">
                  <ul class="list-unstyled navbar__list">
                      <li class="has-sub">
                          <a class="js-arrow" href="#"><i class="fas fa-house-user"></i>House Keeping</a>
                          <ul class="list-unstyled navbar__sub-list js-sub-list">
                              <li class="active has-sub">
                                <a class="js-arrow" href="index.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                              </li>
                              <li>
                                <a class="js-arrow" href="hk.html"><i class="fas fa-tools"></i> Tool House Keeping</a>
                              </li>
                          </ul>
                      </li>
                  </ul>
              </nav>
          </div>
        </aside>

        <!-- Page Container -->
        <div class="page-container">
            <!-- Headbar Menu (moved here) -->
            <div class="w-full bg-white shadow px-4 sm:px-8 py-3 z-10" style="position:sticky;top:0;">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                  <span class="text-xl sm:text-2xl font-bold text-gray-800 tracking-tight text-center sm:text-left">Performance Dashboard</span>
                  <span class="text-xs sm:text-sm text-gray-400 flex items-center justify-center gap-1"><i class="fa fa-thumbtack text-pink-500"></i> Last Updated: Senin 4/24/2025</span>
                </div>
            </div>
            <main class="main-content">
                <div class="flex flex-wrap gap-2 sm:gap-4 mb-4 sm:mb-6 items-end">
                    <select id="branchFilter" class="border rounded px-2 py-1 text-xs sm:text-sm"></select>
                    <input type="date" id="startDate" class="border rounded px-2 py-1 text-xs sm:text-sm">
                    <input type="date" id="endDate" class="border rounded px-2 py-1 text-xs sm:text-sm">
                    <button onclick="applyFilters()" class="bg-blue-500 text-white px-4 py-1 rounded text-xs sm:text-sm">Filter</button>
                </div>
                <div class="dashboard-row">
                    <div>                 
                        <div class="w-full max-w-[220px] sm:max-w-sm md:max-w-md lg:max-w-lg xl:max-w-xl mx-auto">
                          <div class="relative w-full" style="aspect-ratio:4/5;">
                            <canvas id="pieHK" class="w-full h-full absolute top-0 left-0" style="max-width:100%;max-height:100%;"></canvas>
                          </div>
                        </div>
                    </div>
                    <div>
                        <div class="w-full max-w-lg mx-auto">
                          <canvas id="progressSymptom" class="w-full h-48 sm:h-60" style="max-width:100%"></canvas>
                        </div>
                    </div>
                </div>
                <div class="dashboard-row">
                    <div class="w-full max-w-4xl mx-auto">
                        <div class="w-full">
                          <canvas id="barTrend" class="w-full h-56 sm:h-80" style="max-width:100%"></canvas>
                        </div>
                    </div>
                </div>
                <div class="dashboard-row">
                    <div class="overflow-x-auto w-full">
                        <h3 class="font-bold mb-2 text-base sm:text-lg">Symptom to PS</h3>
                        <table id="tableSymptom" class="min-w-full text-xs sm:text-sm"></table>
                    </div>
                    <div class="overflow-x-auto w-full">
                        <h3 class="font-bold mb-2 text-base sm:text-lg">Fallout NOP to PS</h3>
                        <table id="tableNop" class="min-w-full text-xs sm:text-sm"></table>
                    </div>
                    <div class="overflow-x-auto w-full">
                        <h3 class="font-bold mb-2 text-base sm:text-lg">Result House Keeping</h3>
                        <table id="tableHK" class="min-w-full text-xs sm:text-sm"></table>
                    </div>
                </div>
            </main>
            <!-- Improved Footer -->
            <footer class="w-full bg-gray-100 py-4 sm:py-6 mt-8 shadow-inner">
                <div class="container mx-auto flex flex-col md:flex-row justify-between items-center px-2 sm:px-6">
                    <div class="flex items-center gap-2 mb-2 md:mb-0">
                        <img src="images/icon/logo.png" alt="FBB" class="h-8 w-auto">
                        <span class="text-gray-700 font-semibold text-sm sm:text-base">FBB Telkomsel</span>
                    </div>
                    <div class="text-gray-500 text-xs sm:text-sm">&copy; 2025 FBB Telkomsel. All rights reserved.</div>
                    <div class="flex gap-3 mt-2 md:mt-0">
                        <a href="#" class="text-gray-400 hover:text-blue-600"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-gray-400 hover:text-blue-600"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-blue-600"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </footer>
        </div>
        <!-- JS Files -->
        <script src="vendor/jquery-3.2.1.min.js"></script>
        <script src="vendor/bootstrap-4.1/popper.min.js"></script>
        <script src="vendor/bootstrap-4.1/bootstrap.min.js"></script>
        <script src="vendor/slick/slick.min.js"></script>
        <script src="vendor/wow/wow.min.js"></script>
        <script src="vendor/animsition/animsition.min.js"></script>
        <script src="vendor/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
        <script src="vendor/counter-up/jquery.waypoints.min.js"></script>
        <script src="vendor/counter-up/jquery.counterup.min.js"></script> 
        <script src="vendor/circle-progress/circle-progress.min.js"></script> 
        <script src="vendor/perfect-scrollbar/perfect-scrollbar.js"></script> 
        <script src="vendor/chartjs/Chart.bundle.min.js"></script> 
        <script src="vendor/select2/select2.min.js"></script> 
        <script src="js/main.js"></script>
        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <!-- Mobile Menu Script -->
        <script>
          const mobileMenuBtn = document.getElementById('mobileMenuBtn');
          const mobileMenu = document.getElementById('mobileMenu');
          const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
          const closeMobileMenu = document.getElementById('closeMobileMenu');
          function openMenu() {
            mobileMenu.classList.remove('-translate-x-full');
            mobileMenuOverlay.classList.remove('hidden');
          }
          function closeMenu() {
            mobileMenu.classList.add('-translate-x-full');
            mobileMenuOverlay.classList.add('hidden');
          }
          if(mobileMenuBtn) mobileMenuBtn.addEventListener('click', openMenu);
          if(closeMobileMenu) closeMobileMenu.addEventListener('click', closeMenu);
          if(mobileMenuOverlay) mobileMenuOverlay.addEventListener('click', closeMenu);
        </script>
        <!-- Main script for Dashboard -->
        <script>
        // Ambil data dari API, lalu render dashboard
        let allData = [];

        function filterData(data, branch, startDate, endDate) {
          return data.filter(d => {
            if (branch && (d.branch || '').trim() !== branch.trim()) return false;
            if (startDate || endDate) {
              let proviDate = new Date(d.provi_ts);
              if (startDate && proviDate < startDate) return false;
              if (endDate) {
                let endDateEnd = new Date(endDate);
                endDateEnd.setHours(23,59,59,999);
                if (proviDate > endDateEnd) return false;
              }
            }
            return true;
          });
        }

        function renderPieHK(dataToRender) {
          // ... kode lama ...
        }

        function parseMonth(str) {
          // ... existing date parsing logic ...
        }

        function renderBarTrend(dataToRender) {
          // ... existing chart rendering logic ...
        }

        function renderProgressSymptom(dataToRender) {
          // ... existing chart rendering logic ...
        }

        function renderTableSymptom(data) {
          // ... existing table rendering logic ...
        }

        function renderTableNop(data) {
          // ... existing table rendering logic ...
        }

        function renderTableHK(data) {
          // ... existing table rendering logic ...
        }

        function renderBranchFilter(data) {
          // ... existing filter rendering logic ...
        }

        function renderDashboard(data) {
          renderBranchFilter(allData); // Filter options based on all data
          renderPieHK(data);
          renderBarTrend(data);
          renderProgressSymptom(data);
          renderTableSymptom(data);
          renderTableNop(data);
          renderTableHK(data);
        }

        window.applyFilters = function() {
          const branch = document.getElementById('branchFilter').value;
          const startDateRaw = document.getElementById('startDate').value;
          const endDateRaw = document.getElementById('endDate').value;
          const startDate = startDateRaw ? new Date(startDateRaw) : null;
          const endDate = endDateRaw ? new Date(endDateRaw) : null;
          const filtered = filterData(allData, branch, startDate, endDate);
          renderDashboard(filtered);
        }

        document.addEventListener('DOMContentLoaded', async function() {
          try {
            const response = await fetch('/api/firestore');
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            allData = data; // Simpan data ke variabel global
            renderDashboard(allData); // Render dashboard dengan semua data awal
          } catch (error) {
            console.error('Error fetching data:', error);
            // Tampilkan pesan error di halaman jika perlu
          }
        });
        </script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    </body> 
</html>